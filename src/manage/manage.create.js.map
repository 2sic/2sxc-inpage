{"version":3,"file":"manage.create.js","sourceRoot":"","sources":["manage.create.ts"],"names":[],"mappings":"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","sourcesContent":["// A helper-controller in charge of opening edit-dialogs + creating the toolbars for it\r\n// all in-page toolbars etc.\r\n// if loaded, it's found under the $2sxc(module).manage\r\n// it has commands to\r\n// - getButton\r\n// - getToolbar\r\n// - run(...)\r\n// - isEditMode\r\n\r\n(function () {\r\n    $2sxc._manage.initInstance = function(sxc) {\r\n        try {\r\n            initInstance(sxc);\r\n        } catch (e) {\r\n            console.error(\"error in 2sxc - will log but not throw\", e);\r\n        }\r\n    };\r\n\r\n    var mngApi = $2sxc._manage;\r\n    function initInstance(sxc) {\r\n        var editContext = mngApi.getEditContext(sxc);\r\n        var userInfo = mngApi.getUserOfEditContext(editContext);\r\n\r\n        var cmdEngine = $2sxc._commands.instanceEngine(sxc, editContext);\r\n\r\n        var editManager = sxc.manage = {\r\n            //#region Official, public properties and commands, which are stable for use from the outside\r\n            /**\r\n             * run a command - often used in toolbars and custom buttons\r\n             */\r\n            run: cmdEngine.executeAction,\r\n\r\n            /**\r\n             * Generate a button (an <a>-tag) for one specific toolbar-action.\r\n             * @param {Object<any>} actDef - settings, an object containing the specs for the expected buton\r\n             * @param {int} groupIndex - number what button-group it's in'\r\n             * @returns {string} html of a button\r\n             */\r\n            getButton: function (actDef, groupIndex) {\r\n                return $2sxc._toolbarManager.generateButtonHtml(sxc, actDef, groupIndex);\r\n            },\r\n\r\n            /**\r\n             * Builds the toolbar and returns it as HTML\r\n             * @param {Object<any>} tbConfig - general toolbar config\r\n             * @param {Object<any>} moreSettings - additional / override settings\r\n             * @returns {string} html of the current toolbar\r\n             */\r\n            getToolbar: function (tbConfig, moreSettings) {\r\n                return $2sxc._toolbarManager.generateToolbarHtml(sxc, tbConfig, moreSettings);\r\n            },\r\n            //#endregion official, public properties - everything below this can change at any time\r\n\r\n            // internal method to find out if it's in edit-mode\r\n            _isEditMode: function () { return editContext.Environment.IsEditable; },\r\n            _reloadWithAjax: editContext.ContentGroup.SupportsAjax,\r\n            _dialogParameters: mngApi.buildNgDialogParams(sxc, editContext),      // used for various dialogs\r\n            _instanceConfig: mngApi.buildInstanceConfig(editContext), // used to configure buttons / toolbars\r\n            _editContext: editContext,              // metadata necessary to know what/how to edit\r\n            _quickDialogConfig: mngApi.buildQuickDialogConfig(editContext),           // used for in-page dialogs\r\n            _commands: cmdEngine,                        // used to handle the commands for this content-block\r\n            _user: userInfo,\r\n\r\n            // init this object \r\n            init: function init() {\r\n                // enhance UI in case there are known errors / issues\r\n                if (editContext.error.type)\r\n                    editManager._handleErrors(editContext.error.type, $2sxc._manage.getTag(sxc));\r\n\r\n                // todo: move this to dialog-handling\r\n                // display the dialog\r\n                var openDialogId = sessionStorage.getItem(\"dia-cbid\");\r\n                if (editContext.error.type || !openDialogId || openDialogId !== sxc.cbid) return false;\r\n                sessionStorage.removeItem(\"dia-cbid\");\r\n                editManager.run(\"layout\");\r\n            },\r\n\r\n            // private: show error when the app-data hasn't been installed yet for this imported-module\r\n            _handleErrors: function (errType, cbTag) {\r\n                var errWrapper = $(\"<div class=\\\"dnnFormMessage dnnFormWarning sc-element\\\"></div>\");\r\n                var msg = \"\";\r\n                var toolbar = $(\"<ul class='sc-menu'></ul>\");\r\n                if (errType === \"DataIsMissing\") {\r\n                    msg = \"Error: System.Exception: Data is missing - usually when a site is copied but the content / apps have not been imported yet - check 2sxc.org/help?tag=export-import\";\r\n                    toolbar.attr(\"data-toolbar\", '[{\\\"action\\\": \\\"zone\\\"}, {\\\"action\\\": \\\"more\\\"}]');\r\n                }\r\n                errWrapper.append(msg);\r\n                errWrapper.append(toolbar);\r\n                $(cbTag).append(errWrapper);\r\n            },\r\n\r\n            // change config by replacing the guid, and refreshing dependend sub-objects\r\n            _updateContentGroupGuid: function (newGuid) {\r\n                editContext.ContentGroup.Guid = newGuid;\r\n                editManager._instanceConfig = mngApi.buildInstanceConfig(editContext);\r\n            },\r\n\r\n            _getCbManipulator: function () {\r\n                return $2sxc._contentBlock.manipulator(sxc);\r\n            }\r\n        };\r\n\r\n        editManager.init();\r\n        return editManager;\r\n    }\r\n})();"]}