{"version":3,"file":"$quickE.positioning.js","sourceRoot":"","sources":["$quickE.positioning.ts"],"names":[],"mappings":"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","sourcesContent":["// everything related to positioning the quick-edit in-page editing\r\n$(function () {\r\n\r\n\r\n    // Prepare offset calculation based on body positioning\r\n    $quickE.getBodyPosition = function () {\r\n        var bodyPos = $quickE.body.css(\"position\");\r\n        return bodyPos === \"relative\" || bodyPos === \"absolute\"\r\n            ? { x: $quickE.body.offset().left, y: $quickE.body.offset().top }\r\n            : { x: 0, y: 0 };\r\n    };\r\n\r\n    // Refresh content block and modules elements\r\n    $quickE.refreshDomObjects = function () {\r\n        $quickE.bodyOffset = $quickE.getBodyPosition(); // must update this, as sometimes after finishing page load the position changes, like when dnn adds the toolbar\r\n\r\n        //// Cache the panes (because panes can't change dynamically)\r\n        //if (!$quickE.cachedPanes)\r\n        //    $quickE.cachedPanes = $($quickE.selectors.mod.listSelector);\r\n        \r\n        if ($quickE.config.innerBlocks.enable) {\r\n            // get all content-block lists which are empty, or which allow multiple child-items\r\n            var lists = $($quickE.selectors.cb.listSelector)\r\n                .filter(\":not(.\" + $quickE.selectors.cb.singleItem + \"), :empty\");\r\n            $quickE.contentBlocks = lists // $($quickE.selectors.cb.listSelector)\r\n                .find($quickE.selectors.cb.selector)\r\n                .add(lists);// $quickE.selectors.cb.listSelector);\r\n        }\r\n        if ($quickE.config.modules.enable)\r\n            $quickE.modules = $quickE.cachedPanes\r\n                .find($quickE.selectors.mod.selector)\r\n                .add($quickE.cachedPanes);\r\n    };\r\n\r\n    // position, align and show a menu linked to another item\r\n    $quickE.positionAndAlign = function (element, coords) {\r\n        return element.css({\r\n            left: coords.x - $quickE.bodyOffset.x,\r\n            top: coords.yh - $quickE.bodyOffset.y,\r\n            width: coords.element.width()\r\n        }).show();\r\n    };\r\n\r\n    // Refresh positioning / visibility of the quick-insert bar\r\n    $quickE.refresh = function (e) {\r\n        var highlightClass = \"sc-cb-highlight-for-insert\";\r\n        let newDate: any = new Date();\r\n        if (!$quickE.refreshDomObjects.lastCall || (newDate - $quickE.refreshDomObjects.lastCall > 1000)) {\r\n            // console.log('refreshed contentblock and modules');\r\n            $quickE.refreshDomObjects.lastCall = newDate;\r\n            $quickE.refreshDomObjects();\r\n        }\r\n\r\n        if ($quickE.config.innerBlocks.enable && $quickE.contentBlocks) {\r\n            $quickE.nearestCb = $quickE.findNearest($quickE.contentBlocks, { x: e.clientX, y: e.clientY }, $quickE.selectors.cb.selector);\r\n        }\r\n\r\n        if ($quickE.config.modules.enable && $quickE.modules) {\r\n            $quickE.nearestMod = $quickE.findNearest($quickE.modules, { x: e.clientX, y: e.clientY }, $quickE.selectors.mod.selector);\r\n        }\r\n\r\n        $quickE.modActions.toggleClass(\"sc-invisible\", $quickE.nearestMod === null);\r\n        $quickE.cbActions.toggleClass(\"sc-invisible\", $quickE.nearestCb === null);\r\n\r\n        var oldParent = $quickE.main.parentContainer;\r\n\r\n        if ($quickE.nearestCb !== null || $quickE.nearestMod !== null) {\r\n            var alignTo = $quickE.nearestCb || $quickE.nearestMod;\r\n\r\n            // find parent pane to highlight\r\n            var parentPane = $(alignTo.element).closest($quickE.selectors.mod.listSelector);\r\n            var parentCbList = $(alignTo.element).closest($quickE.selectors.cb.listSelector);\r\n            var parentContainer = (parentCbList.length ? parentCbList : parentPane)[0];\r\n\r\n            // put part of the pane-name into the button-labels\r\n            if (parentPane.length > 0) {\r\n                var paneName = parentPane.attr(\"id\") || \"\";\r\n                if (paneName.length > 4) paneName = paneName.substr(4);\r\n                $quickE.modActions.filter(\"[titleTemplate]\").each(function () {\r\n                    var t = $(this);\r\n                    t.attr(\"title\", t.attr(\"titleTemplate\").replace(\"{0}\", paneName));\r\n                });\r\n            }\r\n\r\n            $quickE.positionAndAlign($quickE.main, alignTo, true);\r\n\r\n            // Keep current block as current on menu\r\n            $quickE.main.actionsForCb = $quickE.nearestCb ? $quickE.nearestCb.element : null;\r\n            $quickE.main.actionsForModule = $quickE.nearestMod ? $quickE.nearestMod.element : null;\r\n            $quickE.main.parentContainer = parentContainer;\r\n            $(parentContainer).addClass(highlightClass);\r\n        } else {\r\n            $quickE.main.parentContainer = null;\r\n            $quickE.main.hide();\r\n        }\r\n\r\n        // if previously a parent-pane was highlighted, un-highlight it now\r\n        if (oldParent && oldParent !== $quickE.main.parentContainer)\r\n            $(oldParent).removeClass(highlightClass);\r\n    };\r\n\r\n    // Return the nearest element to the mouse cursor from elements (jQuery elements)\r\n    $quickE.findNearest = function (elements, position) {\r\n        var maxDistance = 30; // Defines the maximal distance of the cursor when the menu is displayed\r\n\r\n        var nearestItem = null;\r\n        var nearestDistance = maxDistance;\r\n\r\n        var posX = position.x + $quickE.win.scrollLeft();\r\n        var posY = position.y + $quickE.win.scrollTop();\r\n\r\n        // Find nearest element\r\n        elements.each(function () {\r\n            var e = $quickE.getCoordinates($(this));\r\n\r\n            // First check x coordinates - must be within container\r\n            if (posX < e.x || posX > e.x + e.w)\r\n                return;\r\n\r\n            // Check if y coordinates are within boundaries\r\n            var distance = Math.abs(posY - e.yh);\r\n\r\n            if (distance < maxDistance && distance < nearestDistance) {\r\n                nearestItem = e;\r\n                nearestDistance = distance;\r\n            }\r\n        });\r\n\r\n\r\n        return nearestItem;\r\n    };\r\n\r\n    $quickE.getCoordinates = function (element) {\r\n        return {\r\n            element: element,\r\n            x: element.offset().left,\r\n            w: element.width(),\r\n            y: element.offset().top,\r\n            // For content-block ITEMS, the menu must be visible at the end\r\n            // For content-block-LISTS, the menu must be at top\r\n            yh: element.offset().top + (element.is($quickE.selectors.eitherCbOrMod) ? element.height() : 0)\r\n        };\r\n    };\r\n\r\n});"]}