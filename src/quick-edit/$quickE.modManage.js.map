{"version":3,"file":"$quickE.modManage.js","sourceRoot":"","sources":["$quickE.modManage.ts"],"names":[],"mappings":"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","sourcesContent":["// module specific stuff\r\n$(function () {\r\n    \"use strict\";\r\n\r\n    $quickE.modManage = {\r\n        \"delete\": deleteMod,\r\n        create: createModWithTypeName,\r\n        move: moveMod,\r\n        getPaneName: getPaneName,\r\n        getModuleId: getModuleId,\r\n        getMoveButtons: generatePaneMoveButtons\r\n    };\r\n\r\n\r\n    function getPaneName(pane) {\r\n        return $(pane).attr(\"id\").replace(\"dnn_\", \"\");\r\n    }\r\n\r\n    // find the correct module id from a list of classes - used on the module-wrapper\r\n    function getModuleId(classes) {\r\n        var result = classes.match(/DnnModule-([0-9]+)(?:\\W|$)/);\r\n        return (result && result.length === 2) ? result[1] : null;\r\n    }\r\n\r\n    // show an error when an xhr error occurs\r\n    function xhrError (xhr, optionalMessage) {\r\n        alert(optionalMessage || \"Error while talking to server.\");\r\n        console.log(xhr);\r\n    }\r\n\r\n    // service calls we'll need\r\n    function createModWithTypeName(paneName, index, type) {\r\n        return sendDnnAjax(null, \"controlbar/GetPortalDesktopModules\", {\r\n            data: \"category=All&loadingStartIndex=0&loadingPageSize=100&searchTerm=\",\r\n            success: function (desktopModules) {\r\n                var moduleToFind = type === \"Default\" ? \" Content\" : \" App\";\r\n                var module = null;\r\n\r\n                desktopModules.forEach(function (e, i) {\r\n                    if (e.ModuleName === moduleToFind)\r\n                        module = e;\r\n                });\r\n\r\n                return (!module)\r\n                    ? alert(moduleToFind + \" module not found.\")\r\n                    : createMod(paneName, index, module.ModuleID);\r\n            }\r\n        });\r\n    }\r\n\r\n    // move a dnn module\r\n    function moveMod(modId, pane, order) {\r\n        var service = $.dnnSF(modId);\r\n        var tabId = service.getTabId();\r\n        var dataVar = {\r\n            TabId: tabId,\r\n            ModuleId: modId,\r\n            Pane: pane,\r\n            ModuleOrder: (2 * order + 4) // strange formula, copied from DNN https://github.com/dnnsoftware/Dnn.Platform/blob/fd225b8de07042837f7473cd49fba13de42a3cc0/Website/admin/Menus/ModuleActions/ModuleActions.js#L70\r\n        };\r\n\r\n        sendDnnAjax(modId, \"ModuleService/MoveModule\", {\r\n            type: \"POST\",\r\n            data: dataVar,\r\n            success: function () {\r\n                window.location.reload();\r\n            }\r\n        });\r\n\r\n        //fire window resize to reposition action menus\r\n        $(window).resize();\r\n    }\r\n    \r\n    // delete a module\r\n    function deleteMod(modId) {\r\n        var service = $.dnnSF(modId);\r\n        var tabId = service.getTabId();\r\n        return sendDnnAjax(modId, \"2sxc/dnn/module/delete\", {\r\n            url: $.dnnSF().getServiceRoot(\"2sxc\") + \"dnn/module/delete\",\r\n            type: \"GET\",\r\n            data: {\r\n                tabId: tabId,\r\n                modId: modId\r\n            },\r\n            success: function(d) {\r\n                window.location.reload();\r\n            }\r\n        });\r\n    }\r\n\r\n    // call an api on dnn\r\n    function sendDnnAjax(modId, serviceName, options) {\r\n        var service = $.dnnSF(modId);\r\n\r\n        return $.ajax($.extend( {\r\n            type: \"GET\",\r\n            url: service.getServiceRoot(\"internalservices\") + serviceName,\r\n            beforeSend: service.setModuleHeaders,\r\n            error: xhrError\r\n        }, options));\r\n    }\r\n\r\n    // create / insert a new module\r\n    function createMod(paneName, position, modId) {\r\n        var postData = {\r\n            Module: modId,\r\n            Page: \"\",\r\n            Pane: paneName,\r\n            Position: -1,\r\n            Sort: position,\r\n            Visibility: 0,\r\n            AddExistingModule: false,\r\n            CopyModule: false\r\n        };\r\n        return sendDnnAjax(null, \"controlbar/AddModule\", {\r\n            type: \"POST\",\r\n            data: postData,\r\n            success: function (d) {\r\n                window.location.reload();\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    function generatePaneMoveButtons(current) {\r\n        var pns = $quickE.cachedPanes;\r\n        // generate list of panes as links\r\n        var targets = $(\"<div>\");\r\n        for (var p = 0; p < pns.length; p++) {\r\n            var pName = $quickE.modManage.getPaneName(pns[p]),\r\n                selected = (current === pName) ? \" selected \" : \"\";\r\n            if (!selected)\r\n                targets.append(\"<a data='\" + pName + \"'>\" + pName + \"</a>\");\r\n        }\r\n\r\n        // attach click event...\r\n        targets.find(\"a\").click(function (d) {\r\n            var link = $(this),\r\n                clip = $quickE.clipboard.data,\r\n                modId = $quickE.modManage.getModuleId(clip.item.className),\r\n                newPane = link.attr(\"data\");\r\n\r\n            $quickE.modManage.move(modId, newPane, 0);\r\n        });\r\n\r\n        return targets;\r\n    }\r\n\r\n});"]}