{"version":3,"file":"contentBlock.render.js","sourceRoot":"","sources":["contentBlock.render.ts"],"names":[],"mappings":";;AAIA;;;;;;;;;GASG;AACH,CAAC;IACG,IAAI,GAAG,GAAG,KAAK,CAAC,aAAa,CAAC;IAE9B;;;;;;;OAOG;IACH,GAAG,CAAC,SAAS,GAAG,UAAU,GAAG,EAAE,UAAU,EAAE,WAAW;QAClD,IAAI,CAAC;YACD,IAAI,QAAQ,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC;YAE7B,+CAA+C;YAC/C,EAAE,CAAC,CAAC,WAAW,CAAC;gBAAC,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAEzD,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;YAEnD,kDAAkD;YAClD,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACvB,CAAC;QAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACT,OAAO,CAAC,GAAG,CAAC,iCAAiC,EAAE,CAAC,CAAC,CAAC;QACtD,CAAC;IACL,CAAC,CAAC;IAEF;;;;;OAKG;IACH,GAAG,CAAC,WAAW,GAAG,UAAU,GAAG,EAAE,UAAU;QACvC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAClD,CAAC,CAAC;IAEF,GAAG,CAAC,QAAQ,GAAG,UAAU,GAAG,EAAE,mBAAmB,EAAE,WAAW;QAC1D,0BAA0B;QAC1B,MAAM,CAAC,GAAG,CAAC,sBAAsB,CAAC,GAAG,EAAE,mBAAmB,CAAC;aACtD,IAAI,CAAC,UAAU,MAAM;YAClB,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;QACnD,CAAC,CAAC;aACD,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,0DAA0D;IACxF,CAAC,CAAC;IAEF,yFAAyF;IACzF,GAAG,CAAC,qBAAqB,GAAG,UAAU,GAAG,EAAE,SAAS,EAAE,OAAO;QACzD,IAAI,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;QAExB,0DAA0D;QAC1D,EAAE,CAAC,CAAC,CAAC,SAAS,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC;YAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QAE3E,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,oBAAoB,EAAE,CAAC,CAAC,OAAO,CAAC;aACxD,IAAI,CAAC;YAEF,gEAAgE;YAChE,EAAE,CAAC,CAAC,MAAM,CAAC,wBAAwB,CAAC;gBAChC,IAAI,CAAC;oBACD,MAAM,CAAC,GAAG,CAAC,oBAAoB,CAAC,+BAA+B,EAAE,CAAC;gBACtE,CAAC;gBACD,KAAK,CAAA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA,CAAC;YAEf,iCAAiC;YACjC,yBAAyB;YACzB,sGAAsG;YAEtG,sGAAsG;YACtG,0FAA0F;YAC1F,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;QAC9B,CAAC,CAAC,CAAC;IACX,CAAC,CAAC;AAEN,CAAC,CAAC,EAAE,CAAC","sourcesContent":["import { Window } from '../interfaces/window';\r\n\r\ndeclare var window: Window;\r\n\r\n/*\r\n * this is the content block manager in the browser\r\n * \r\n * A Content Block is a standalone unit of content, with it's own definition of\r\n * 1. content items\r\n * 2. template\r\n * + some other stuff\r\n *\r\n * it should be able to render itself\r\n */\r\n(function () {\r\n    var cbm = $2sxc._contentBlock;\r\n\r\n    /**\r\n     * ajax update/replace the content of the content-block\r\n     * optionally also initialze the toolbar (if not just preview)\r\n     * @param {Object<>} sxc \r\n     * @param {string} newContent \r\n     * @param {boolean} justPreview \r\n     * @returns {} \r\n     */\r\n    cbm.replaceCb = function (sxc, newContent, justPreview) {\r\n        try {\r\n            var newStuff = $(newContent);\r\n\r\n            // Must disable toolbar before we attach to DOM\r\n            if (justPreview) $2sxc._toolbarManager.disable(newStuff);\r\n\r\n            $($2sxc._manage.getTag(sxc)).replaceWith(newStuff);\r\n\r\n            // reset the cache, so the sxc-object is refreshed\r\n            sxc.recreate(true);\r\n        } catch (e) {\r\n            console.log(\"Error while rendering template:\", e);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Show a message where the content of a module should be - usually as placeholder till something else happens\r\n     * @param {object} sxc \r\n     * @param {string} newContent \r\n     * @returns {} - nothing\r\n     */\r\n    cbm.showMessage = function (sxc, newContent) {\r\n        $($2sxc._manage.getTag(sxc)).html(newContent);\r\n    };\r\n\r\n    cbm.ajaxLoad = function (sxc, alternateTemplateId, justPreview) {\r\n        // ajax-call, then replace\r\n        return cbm.getPreviewWithTemplate(sxc, alternateTemplateId)\r\n            .then(function (result) {\r\n                return cbm.replaceCb(sxc, result, justPreview);\r\n            })\r\n            .then($quickE.reset); // reset quick-edit, because the config could have changed\r\n    };\r\n\r\n    // this one assumes a replace / change has already happened, but now must be finalized...\r\n    cbm.reloadAndReInitialize = function (sxc, forceAjax, preview) {\r\n        var manage = sxc.manage;\r\n\r\n        // if ajax is not supported, we must reload the whole page\r\n        if (!forceAjax && !manage._reloadWithAjax) return window.location.reload();\r\n\r\n        return cbm.ajaxLoad(sxc, cbm.cUseExistingTemplate, !!preview)\r\n            .then(function () {\r\n                \r\n                // tell Evoq that page has changed if it has changed (Ajax call)\r\n                if (window.dnn_tabVersioningEnabled) // this only exists in evoq or on new DNNs with tabVersioning\r\n                    try {\r\n                        window.dnn.ContentEditorManager.triggerChangeOnPageContentEvent();\r\n                    }\r\n                    catch(e) {}\r\n\r\n                // maybe check if already publish\r\n                // compare to HTML module\r\n                // if (publishing is required (FROM CONTENT BLOCK) and publish button not visible) show publish button\r\n\r\n                // 2017-09-02 2dm - believe this was meant to re-init the dialog manager, but it doesn't actually work\r\n                // must check for side-effects, which would need the manager to re-build the configuration\r\n                $2sxc._quickDialog.hide();\r\n            });\r\n    };\r\n\r\n})();\r\n"]}