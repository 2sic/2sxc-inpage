{"version":3,"file":"contentBlock.templates.js","sourceRoot":"","sources":["contentBlock.templates.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,CAAC;IACG,IAAI,GAAG,GAAG,KAAK,CAAC,aAAa,CAAC;IAE9B,4HAA4H;IAC5H,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE;QACf,mBAAmB,EAAE,mBAAmB;QACxC,qBAAqB,EAAE,qBAAqB;KAC/C,CAAC,CAAC;IAEH,MAAM,CAAC;IAEP;;;;;OAKG;IACH,6BAA6B,GAAG,EAAE,aAAa;QAC3C,IAAI,SAAS,GAAG,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,SAAS,CAAC;QAC/D,EAAE,CAAC,CAAC,SAAS,IAAI,CAAC,aAAa,CAAC;YAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,qCAAqC;QACrC,2BAA2B;QAC3B,uDAAuD;QACvD,kEAAkE;QAClE,8FAA8F;QAE9F,IAAI,UAAU,GAAuB,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,UAAU,CAAC;QAErF,2BAA2B;QAC3B,4DAA4D;QAE5D,uBAAuB;QACvB,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,UAAU,EAAE,IAAI,CAAC,CAAC;IACjD,CAAC;IAED;;;;;OAKG;IACH,+BAA+B,GAAG,EAAE,UAAU,EAAE,WAAW;QACvD,IAAI,YAAY,GAAG,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC;QACxD,IAAI,kBAAkB,GAAG,KAAK,CAAC,eAAe,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAE/D,+FAA+F;QAC/F,4DAA4D;QAC5D,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,UAAU,EAAE,WAAW,CAAC;aAC9C,IAAI,CAAC;YACF,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;YAE1B,qDAAqD;YACrD,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,UAAU,CAAC;gBAAC,YAAY,CAAC,UAAU,GAAG,WAAW,CAAC;YAEpE,+EAA+E;YAC/E,gDAAgD;YAChD,EAAE,CAAC,CAAC,kBAAkB,CAAC;gBAAC,GAAG,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC;QAC3D,CAAC,CAAC,CAAC;IACX,CAAC;IAED;;OAEG;IACH,wBAAwB,GAAG,EAAE,UAAU,EAAE,WAAW;QAChD,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE,UAAU,EAAE,WAAW,CAAC;aAChD,IAAI,CAAC,UAAU,IAAI,EAAE,UAAU,EAAE,GAAG;YAEjC,iBAAiB;YACjB,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,KAAK,GAAG,CAAC;gBAAC,MAAM,CAAC,KAAK,CAAC,4DAA4D,CAAC,CAAC;YAEnG,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;gBAAC,MAAM,CAAC;YAElB,yGAAyG;YACzG,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAE3C,EAAE,CAAC,CAAC,OAAO,CAAC;gBAAC,OAAO,CAAC,GAAG,CAAC,yBAAyB,GAAG,OAAO,GAAG,GAAG,CAAC,CAAC;YACpE,GAAG,CAAC,MAAM,CAAC,uBAAuB,CAAC,OAAO,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACX,CAAC;AACL,CAAC,CAAC,EAAE,CAAC","sourcesContent":["/* \r\n * this is part of the content block manager\r\n */\r\n(function () {\r\n    var cbm = $2sxc._contentBlock;\r\n\r\n    // https://stackoverflow.com/questions/38860161/using-typescript-and-object-assign-gives-me-an-error-property-assign-does-no\r\n    Object.assign(cbm, {\r\n        prepareToAddContent: prepareToAddContent,\r\n        updateTemplateFromDia: updateTemplateFromDia\r\n    });\r\n\r\n    return;\r\n\r\n    /**\r\n     * prepare the instance so content can be added\r\n     * this ensure the content-group has been created, which is required to add content\r\n     * @param {} sxc \r\n     * @returns {} \r\n     */\r\n    function prepareToAddContent(sxc, useModuleList) {\r\n        var isCreated = sxc.manage._editContext.ContentGroup.IsCreated;\r\n        if (isCreated || !useModuleList) return $.when(null);\r\n        // return persistTemplate(sxc, null);\r\n        // var manage = sxc.manage;\r\n        // var contentGroup = manage._editContext.ContentGroup;\r\n        // var showingAjaxPreview = $2sxc._toolbarManager.isDisabled(sxc);\r\n        // var groupExistsAndTemplateUnchanged = !!contentGroup.HasContent; // && !showingAjaxPreview;\r\n\r\n        var templateId = /* templateId || */ sxc.manage._editContext.ContentGroup.TemplateId;\r\n\r\n        // template has not changed\r\n        // if (groupExistsAndTemplateUnchanged) return $.when(null);\r\n\r\n        // persist the template\r\n        return updateTemplate(sxc, templateId, true);\r\n    }\r\n\r\n    /**\r\n     * Update the template and adjust UI accordingly.\r\n     * @param {*} sxc \r\n     * @param {*} templateId \r\n     * @param {*} forceCreate \r\n     */\r\n    function updateTemplateFromDia(sxc, templateId, forceCreate) {\r\n        var contentGroup = sxc.manage._editContext.ContentGroup;\r\n        var showingAjaxPreview = $2sxc._toolbarManager.isDisabled(sxc);\r\n\r\n        // todo: should move things like remembering undo etc. back into the contentBlock state manager\r\n        // or just reset it, so it picks up the right values again ?\r\n        return updateTemplate(sxc, templateId, forceCreate)\r\n            .then(function () {\r\n                $2sxc._quickDialog.hide();\r\n\r\n                // if it didn't have content, then it only has now...\r\n                if (!contentGroup.HasContent) contentGroup.HasContent = forceCreate;\r\n\r\n                // only reload on ajax, not on app as that was already re-loaded on the preview\r\n                // necessary to show the original template again\r\n                if (showingAjaxPreview) cbm.reloadAndReInitialize(sxc);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Update the template.\r\n     */\r\n    function updateTemplate(sxc, templateId, forceCreate) {\r\n        return cbm.saveTemplate(sxc, templateId, forceCreate)\r\n            .then(function (data, textStatus, xhr) {\r\n\r\n                // error handling\r\n                if (xhr.status !== 200) return alert('error - result not ok, was not able to create ContentGroup');\r\n\r\n                if (!data) return;\r\n\r\n                // fixes a special case where the guid is given with quotes (dependes on version of angularjs) issue #532\r\n                let newGuid = data.replace(/[\\\",\\']/g, '');\r\n\r\n                if (console) console.log('created content group {' + newGuid + '}');\r\n                sxc.manage._updateContentGroupGuid(newGuid);\r\n            });\r\n    }\r\n})();"]}